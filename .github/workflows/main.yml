name: Update Resource List

on:
  push:
    branches: [main]

jobs:
  update_readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install ruamel.yaml
        run: pip install ruamel.yaml

      - name: Parse template.yml
        run: |
          python - <<EOF
          import ruamel.yaml

          with open('template.yml', 'r') as file:
              template = ruamel.yaml.YAML().load(file)

          resources = template.get('Resources', {})
          resource_names = list(resources.keys())

          with open('README.md', 'a') as file:
              file.write('### AWS Resources\n\n')
              file.write('The following AWS resources are defined in the CloudFormation template:\n\n')
              for resource in resource_names:
                  file.write(f'- {resource}\n')
          EOF

      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "Update resource list"
          git push
